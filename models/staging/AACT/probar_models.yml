version: 2

models:

  # =========================================================================
  # base_aact_design_group
  # =========================================================================
  - name: base_aact_design_group
    description: "Base cleaned version of AACT table design_groups."
    columns:
      - name: id_design_groups
        description: "Design group identifier."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized NCT identifier (uppercase, alphanumeric)."
        tests:
          - not_null
          - unique
      - name: group_type_id
        description: "Hashed identifier of group_type."
        tests:
          - not_null
      - name: group_type
        description: "Group type name."
      - name: title
        description: "Group title."
      - name: description
        description: "Group description."

  # =========================================================================
  # design_group
  # =========================================================================
  - name: design_group
    description: "Staging table for AACT design_groups."
    columns:
      - name: id_design_groups
        description: "Design group ID."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Cleaned clinical trial ID."
        tests:
          - not_null
      - name: group_type_id
        description: "Hashed group type ID."
      - name: title
        description: "Group title."
      - name: description
        description: "Group description."

  # =========================================================================
  # group_type
  # =========================================================================
  - name: group_type
    description: "Distinct group types with hashed keys."
    columns:
      - name: group_type_id
        description: "Hashed group type ID."
        tests:
          - not_null
          - unique
      - name: group_type
        description: "Group type."
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["no_group_type"]

  # =========================================================================
  # design_group_interventions
  # =========================================================================
  - name: design_group_interventions
    description: "Base cleaned version of design_group_interventions."
    columns:
      - name: id_design_group_interventions
        description: "Unique identifier for this row."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized NCT identifier."
        tests:
          - not_null
      - name: design_group_id
        description: "FK to design_groups.id_design_groups."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('base_aact_design_group')
                field: id_design_groups
      - name: intervention_id
        description: "FK to interventions table (when available)."
        tests:
          - not_null

  # =========================================================================
  # conditions
  # =========================================================================
  - name: conditions
    description: "AACT condition table."
    columns:
      - name: id_condition
        description: "Unique condition identifier."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized clinical trial identifier."
        tests:
          - not_null
          - relationships:
              config:
                severity: warn
              arguments:
                to: ref('base_aact_design_group')
                field: nct_id
      - name: condition_name
        description: "Lowercased condition name."

  # =========================================================================
  # base_aact_drop_withdrawals
  # =========================================================================
  - name: base_aact_drop_withdrawals
    description: "Base cleaned version of AACT drop_withdrawals table."
    columns:
      - name: id_drop_withdrawals
        description: "Unique identifier for drop withdrawals."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized NCT identifier."
        tests:
          - not_null
      - name: result_group_id
        description: "Hashed ID of result group."
        tests:
          - relationships:
              arguments:
                to: ref('result_group')
                field: result_group_id
      - name: result_group_name
        description: "Name of the result group."
      - name: ctgov_group_code_id
        description: "Hashed code for result group classification."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('ctgov_group_code')
                field: ctgov_group_code_id
      - name: ctgov_group_code
        description: "Raw CTGOV group code."
      - name: period_id
        description: "Hashed identifier of the reporting period."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('period')
                field: period_id
      - name: period
        description: "Period label."
      - name: reason_id
        description: "Hashed identifier for the withdrawal reason."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('reason')
                field: reason_id
      - name: reason
        description: "Withdrawal reason."
      - name: count
        description: "Number of withdrawals."
        tests:
          - not_null

  # =========================================================================
  # drop_withdrawals
  # =========================================================================
  - name: drop_withdrawals
    description: "Staging drop withdrawals referencing normalized entities."
    columns:
      - name: id_drop_withdrawals
        description: "Drop withdrawals ID."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized clinical trial ID."
        tests:
          - not_null
      - name: result_group_id
        description: "FK to result_group."
        tests:
          - relationships:
              arguments:
                to: ref('result_group')
                field: result_group_id
      - name: ctgov_group_code_id
        description: "FK to ctgov_group_code."
        tests:
          - relationships:
              arguments:
                to: ref('ctgov_group_code')
                field: ctgov_group_code_id
      - name: period_id
        description: "FK to period."
        tests:
          - relationships:
              arguments:
                to: ref('period')
                field: period_id
      - name: reason_id
        description: "FK to reason."
        tests:
          - relationships:
              arguments:
                to: ref('reason')
                field: reason_id
      - name: count
        description: "Number of withdrawals."

  # =========================================================================
  # ctgov_group_code
  # =========================================================================
  - name: ctgov_group_code
    description: "Distinct CTGOV group codes."
    columns:
      - name: ctgov_group_code_id
        description: "Hashed identifier of ctgov group code."
        tests:
          - not_null
          - unique
      - name: ctgov_group_code
        description: "CTGOV group code."
        tests:
          - not_null

  # =========================================================================
  # period
  # =========================================================================
  - name: period
    description: "Distinct periods for drop withdrawals."
    columns:
      - name: period_id
        description: "Hashed identifier for period."
        tests:
          - not_null
          - unique
      - name: period
        description: "Period label."
        tests:
          - not_null

  # =========================================================================
  # reason
  # =========================================================================
  - name: reason
    description: "Distinct reasons for drop withdrawals."
    columns:
      - name: reason_id
        description: "Hashed identifier for reason."
        tests:
          - not_null
          - unique
      - name: reason
        description: "Reason label."
        tests:
          - not_null

  # =========================================================================
  # result_group
  # =========================================================================
  - name: result_group
    description: "Distinct result groups used in drop withdrawals."
    columns:
      - name: result_group_id
        description: "Hashed identifier for result group."
        tests:
          - not_null
          - unique
      - name: result_group_name
        description: "Name of the result group."
        tests:
          - not_null

  # =========================================================================
  # base_aact_facilities
  # =========================================================================
  - name: base_aact_facilities
    description: "Base cleaned version of AACT facilities table."
    columns:
      - name: id_facilities
        description: "Unique identifier for facility."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized clinical trial identifier."
        tests:
          - not_null
      - name: status_id
        description: "Hashed identifier for facility status."
        tests:
          - not_null
          - relationships:
              to: ref('status')
              field: status_id
      - name: status
        description: "Facility status."
      - name: name
        description: "Facility name."
      - name: country_id
        description: "Hashed identifier for facility country."
        tests:
          - not_null
          - relationships:
              to: ref('country')
              field: country_id
      - name: country
        description: "Facility country."
      - name: latitude
        description: "Latitude of facility location."
      - name: longitude
        description: "Longitude of facility location."

  # =========================================================================
  # facilities
  # =========================================================================
  - name: facilities
    description: "Staging table referencing cleaned facilities."
    columns:
      - name: id_facilities
        description: "Facility ID."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized clinical trial ID."
        tests:
          - not_null
      - name: status_id
        description: "FK to status."
        tests:
          - relationships:
              to: ref('status')
              field: status_id
      - name: name
        description: "Facility name."
      - name: country_id
        description: "FK to country."
        tests:
          - relationships:
              to: ref('country')
              field: country_id
      - name: latitude
        description: "Latitude."
      - name: longitude
        description: "Longitude."

  # =========================================================================
  # base_aact_interventions
  # =========================================================================
  - name: base_aact_interventions
    description: "Base cleaned version of AACT interventions table."
    columns:
      - name: id_interventions
        description: "Unique identifier for intervention."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized clinical trial identifier."
        tests:
          - not_null
      - name: intervention_type_id
        description: "Hashed identifier of intervention type."
        tests:
          - not_null
      - name: intervention_type
        description: "Intervention type."
      - name: name
        description: "Intervention name."
      - name: description
        description: "Intervention description."

  # =========================================================================
  # interventions
  # =========================================================================
  - name: interventions
    description: "Staging table for interventions."
    columns:
      - name: id_interventions
        description: "Intervention ID."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized clinical trial ID."
        tests:
          - not_null
      - name: intervention_type_id
        description: "Hashed intervention type ID."
      - name: name
        description: "Intervention name."
      - name: description
        description: "Intervention description."

  # =========================================================================
  # base_aact_reported_events_total
  # =========================================================================
  - name: base_aact_reported_events_total
    description: "Base cleaned version of AACT reported events total table."
    columns:
      - name: id_reported_events_total
        description: "Unique identifier for reported events."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Normalized NCT identifier."
        tests:
          - not_null
      - name: ctgov_group_code_id
        description: "Hashed CTGOV group code identifier."
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('ctgov_group_code')
                field: ctgov_group_code_id
      - name: ctgov_group_code
        description: "Raw CTGOV group code."
      - name: event_type_id
        description: "Hashed event type ID."
        tests:
          - not_null
      - name: event_type
        description: "Event type."
      - name: classification_id
        description: "Hashed classification ID."
        tests:
          - not_null
      - name: classification
        description: "Classification label."
      - name: created_at
        description: "Creation timestamp."
      - name: updated_at
        description: "Update timestamp."

  # =========================================================================
  # reported_events_total
  # =========================================================================
  - name: reported_events_total
    description: "Staging table for reported events total."
    columns:
      - name: id_reported_events_total
        description: "Reported event identifier."
        tests:
          - not_null
          - unique
      - name: nct_id
        description: "Cleaned NCT ID."
        tests:
          - not_null
      - name: ctgov_group_code_id
        description: "FK to ctgov_group_code."
        tests:
          - relationships:
              arguments:
                to: ref('ctgov_group_code')
                field: ctgov_group_code_id
      - name: event_type_id
        description: "Event type hash."
      - name: classification_id
        description: "Classification hash."
      - name: created_at
        description: "Created timestamp."
      - name: updated_at
        description: "Updated timestamp."

  # =========================================================================
  # status
  # =========================================================================
  - name: status
    description: "Distinct facility status values."
    columns:
      - name: status_id
        description: "Hashed identifier for status."
        tests:
          - not_null
          - unique
      - name: status
        description: "Status label."
        tests:
          - not_null

  # =========================================================================
  # country
  # =========================================================================
  - name: country
    description: "Distinct country values appearing in facilities."
    columns:
      - name: country_id
        description: "Hashed identifier for country."
        tests:
          - not_null
          - unique
      - name: country
        description: "Country name."
        tests:
          - not_null

  # =========================================================================
  # intervention_type
  # =========================================================================
  - name: intervention_type
    description: "Distinct intervention types."
    columns:
      - name: intervention_type_id
        description: "Hashed identifier for intervention type."
        tests:
          - not_null
          - unique
      - name: intervention_type
        description: "Intervention type."
        tests:
          - not_null

  # =========================================================================
  # result_group
  # =========================================================================
  - name: result_group
    description: "Distinct result groups used in drop withdrawals."
    columns:
      - name: result_group_id
        description: "Hashed identifier for result group."
        tests:
          - not_null
          - unique
      - name: result_group_name
        description: "Name of the result group."
        tests:
          - not_null

  # =========================================================================
  # period
  # =========================================================================
  - name: period
    description: "Distinct periods for drop withdrawals."
    columns:
      - name: period_id
        description: "Hashed identifier for period."
        tests:
          - not_null
          - unique
      - name: period
        description: "Period label."
        tests:
          - not_null

  # =========================================================================
  # reason
  # =========================================================================
  - name: reason
    description: "Distinct reasons for drop withdrawals."
    columns:
      - name: reason_id
        description: "Hashed identifier for reason."
        tests:
          - not_null
          - unique
      - name: reason
        description: "Reason label."
        tests:
          - not_null
